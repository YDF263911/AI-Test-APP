# Supabaseæ•°æ®åº“ç»“æ„éªŒè¯æŠ¥å‘Š

## âœ… æ•°æ®åº“ç»“æ„ç¬¦åˆè¦æ±‚

é€šè¿‡MCPå·¥å…·éªŒè¯ï¼Œå½“å‰Supabaseæ•°æ®åº“ç»“æ„å®Œå…¨ç¬¦åˆç™»å½•æ³¨å†ŒåŠŸèƒ½çš„è¦æ±‚ã€‚

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### 1. ç”¨æˆ·é…ç½®è¡¨ (user_profiles) âœ…
**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯å’Œè®¤è¯æ•°æ®

**å…³é”®å­—æ®µ**:
- `id` (text, PRIMARY KEY) - ç”¨æˆ·å”¯ä¸€æ ‡è¯†
- `email` (text, UNIQUE) - ç”¨æˆ·é‚®ç®±ï¼Œç”¨äºç™»å½•
- `username` (text, UNIQUE) - ç”¨æˆ·åï¼Œæ˜¾ç¤ºç”¨
- `password` (text) - **æ–°å¢** - ç”¨æˆ·å¯†ç ï¼Œç”¨äºèº«ä»½éªŒè¯
- `display_name` (text) - æ˜¾ç¤ºåç§°
- `avatar_url` (text) - å¤´åƒURL
- `device_id` (text, UNIQUE) - è®¾å¤‡IDï¼ˆç”¨äºæ¸¸å®¢æ¨¡å¼ï¼‰
- `daily_goal` (integer, default: 20) - æ¯æ—¥å­¦ä¹ ç›®æ ‡
- `total_questions` (bigint, default: 0) - æ€»ç­”é¢˜æ•°
- `correct_questions` (bigint, default: 0) - æ­£ç¡®ç­”é¢˜æ•°
- `study_days` (integer, default: 0) - å­¦ä¹ å¤©æ•°
- `study_streak` (integer, default: 0) - è¿ç»­å­¦ä¹ å¤©æ•°
- `is_premium` (boolean, default: false) - ä¼šå‘˜çŠ¶æ€
- `created_at` / `updated_at` - æ—¶é—´æˆ³

**å¤–é”®å…³ç³»**:
- `study_statistics.user_id` â†’ `user_profiles.id`
- `answer_records.user_id` â†’ `user_profiles.id`
- `wrong_questions.user_id` â†’ `user_profiles.id`

### 2. é¢˜ç›®è¡¨ (questions) âœ…
**ç”¨é€”**: å­˜å‚¨é¢˜åº“æ•°æ®

**å…³é”®å­—æ®µ**:
- `id` (text, PRIMARY KEY) - é¢˜ç›®ID
- `title` (text) - é¢˜ç›®æ ‡é¢˜
- `options` (ARRAY) - é€‰é¡¹æ•°ç»„
- `correct_answer` (integer) - æ­£ç¡®ç­”æ¡ˆ
- `analysis` (text) - é¢˜ç›®è§£æ
- `type` (text) - é¢˜ç›®ç±»å‹
- `category` (text) - é¢˜ç›®åˆ†ç±»
- `difficulty` (integer, CHECK: 1-5) - éš¾åº¦ç­‰çº§
- `created_at` / `updated_at` - æ—¶é—´æˆ³

**å¤–é”®çº¦æŸ**:
- `answer_records.question_id` â†’ `questions.id`
- `wrong_questions.question_id` â†’ `questions.id`

### 3. é”™é¢˜è¡¨ (wrong_questions) âœ…
**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·é”™é¢˜è®°å½•

**å…³é”®å­—æ®µ**:
- `id` (text, PRIMARY KEY) - è®°å½•ID
- `user_id` (text) - **å¤–é”®** - å…³è”ç”¨æˆ·
- `question_id` (text) - **å¤–é”®** - å…³è”é¢˜ç›®
- `question_title` (text) - é¢˜ç›®æ ‡é¢˜ï¼ˆå†—ä½™å­˜å‚¨ï¼‰
- `user_answer` (integer) - ç”¨æˆ·ç­”æ¡ˆ
- `correct_answer` (integer) - æ­£ç¡®ç­”æ¡ˆ
- `review_count` (integer, default: 1) - å¤ä¹ æ¬¡æ•°
- `mastery_level` (integer, CHECK: 1-5) - æŒæ¡ç­‰çº§
- `is_mastered` (boolean, default: false) - æ˜¯å¦å·²æŒæ¡
- `last_review_date` (date) - æœ€åå¤ä¹ æ—¥æœŸ
- `next_review_date` (date) - ä¸‹æ¬¡å¤ä¹ æ—¥æœŸ
- `created_at` / `updated_at` - æ—¶é—´æˆ³

### 4. ç­”é¢˜è®°å½•è¡¨ (answer_records) âœ…
**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·ç­”é¢˜å†å²

**å…³é”®å­—æ®µ**:
- `id` (text, PRIMARY KEY) - è®°å½•ID
- `user_id` (text) - **å¤–é”®** - å…³è”ç”¨æˆ·
- `question_id` (text) - **å¤–é”®** - å…³è”é¢˜ç›®
- `user_answer` (integer) - ç”¨æˆ·ç­”æ¡ˆ
- `is_correct` (boolean) - æ˜¯å¦æ­£ç¡®
- `answer_time` (integer) - ç­”é¢˜è€—æ—¶
- `session_id` (text) - ä¼šè¯ID
- `created_at` (timestamp with time zone) - ç­”é¢˜æ—¶é—´

### 5. å­¦ä¹ ç»Ÿè®¡è¡¨ (study_statistics) âœ…
**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·å­¦ä¹ ç»Ÿè®¡æ•°æ®

**å…³é”®å­—æ®µ**:
- `id` (text, PRIMARY KEY) - ç»Ÿè®¡ID
- `user_id` (text) - **å¤–é”®** - å…³è”ç”¨æˆ·
- `date` (date, UNIQUE) - ç»Ÿè®¡æ—¥æœŸ
- `questions_answered` (integer, default: 0) - å½“æ—¥ç­”é¢˜æ•°
- `questions_correct` (integer, default: 0) - å½“æ—¥æ­£ç¡®æ•°
- `study_time` (integer, default: 0) - å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
- `categories_practiced` (ARRAY) - ç»ƒä¹ çš„åˆ†ç±»
- `subjects_practiced` (ARRAY) - ç»ƒä¹ çš„ç§‘ç›®
- `created_at` / `updated_at` - æ—¶é—´æˆ³

### 6. é¢˜ç›®åˆ†ç±»è¡¨ (question_categories) âœ…
**ç”¨é€”**: å­˜å‚¨é¢˜ç›®åˆ†ç±»

**å…³é”®å­—æ®µ**:
- `id` (text, PRIMARY KEY) - åˆ†ç±»ID
- `name` (text, UNIQUE) - åˆ†ç±»åç§°
- `description` (text) - åˆ†ç±»æè¿°
- `icon` (text) - å›¾æ ‡æ ‡è¯†
- `sort_order` (integer) - æ’åº
- `is_active` (boolean, default: true) - æ˜¯å¦å¯ç”¨

### 7. ç§‘ç›®è¡¨ (subjects) âœ…
**ç”¨é€”**: å­˜å‚¨å­¦ä¹ ç§‘ç›®

**å…³é”®å­—æ®µ**:
- `id` (text, PRIMARY KEY) - ç§‘ç›®ID
- `name` (text, UNIQUE) - ç§‘ç›®åç§°
- `category_id` (text) - **å¤–é”®** - å…³è”åˆ†ç±»
- `description` (text) - ç§‘ç›®æè¿°
- `icon` (text) - å›¾æ ‡æ ‡è¯†
- `sort_order` (integer) - æ’åº
- `is_active` (boolean, default: true) - æ˜¯å¦å¯ç”¨

## ğŸ”’ å®‰å…¨æ€§ç‰¹æ€§

### RLS (Row Level Security) âœ…
- æ‰€æœ‰è¡¨éƒ½å¯ç”¨äº†RLSç­–ç•¥
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- æ•°æ®éš”ç¦»å®Œå…¨ç¬¦åˆå®‰å…¨è¦æ±‚

### å¤–é”®çº¦æŸ âœ…
- æ‰€æœ‰è¡¨ä¹‹é—´çš„å…³ç³»éƒ½æ­£ç¡®å»ºç«‹
- æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§å¾—åˆ°ä¿éšœ
- çº§è”åˆ é™¤é…ç½®æ­£ç¡®

### æ•°æ®éªŒè¯ âœ…
- éš¾åº¦ç­‰çº§çº¦æŸ (1-5)
- æŒæ¡ç­‰çº§çº¦æŸ (1-5)
- é‚®ç®±å”¯ä¸€æ€§çº¦æŸ
- ç”¨æˆ·åå”¯ä¸€æ€§çº¦æŸ

## âœ… æ–°å¢å­—æ®µéªŒè¯

é€šè¿‡MCPå·¥å…·æˆåŠŸæ·»åŠ äº† `user_profiles.password` å­—æ®µï¼š

```sql
ALTER TABLE user_profiles ADD COLUMN IF NOT EXISTS password TEXT;
```

**éªŒè¯ç»“æœ**:
- âœ… å­—æ®µæ·»åŠ æˆåŠŸ
- âœ… æ•°æ®ç±»å‹æ­£ç¡® (TEXT)
- âœ… æ”¯æŒç”¨æˆ·è®¤è¯åŠŸèƒ½
- âœ… å…¼å®¹ç°æœ‰æ•°æ®

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡

**å½“å‰æ•°æ®é‡**:
- `questions`: 615æ¡è®°å½• - å®Œæ•´é¢˜åº“
- `user_profiles`: 2æ¡è®°å½• - ç°æœ‰ç”¨æˆ·æ•°æ®
- `wrong_questions`: 6æ¡è®°å½• - ç¤ºä¾‹é”™é¢˜
- `question_categories`: 3æ¡è®°å½• - åŸºç¡€åˆ†ç±»
- `subjects`: 11æ¡è®°å½• - ä¸°å¯Œç§‘ç›®

**å®Œæ•´æ€§è¯„ä¼°**:
- âœ… è¡¨ç»“æ„å®Œæ•´
- âœ… å…³ç³»æ­£ç¡®
- âœ… çº¦æŸæœ‰æ•ˆ
- âœ… RLSç­–ç•¥å¯ç”¨
- âœ… æ”¯æŒè®¤è¯ç³»ç»Ÿ

## ğŸ¯ è®¤è¯ç³»ç»Ÿæ”¯æŒ

### ç”¨æˆ·æ³¨å†Œ
- âœ… é‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥
- âœ… ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
- âœ… å¯†ç å­˜å‚¨æ”¯æŒ
- âœ… ç”¨æˆ·é…ç½®æ–‡ä»¶è‡ªåŠ¨åˆ›å»º

### ç”¨æˆ·ç™»å½•
- âœ… é‚®ç®±å¯†ç éªŒè¯
- âœ… ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢
- âœ… ç™»å½•çŠ¶æ€ç®¡ç†

### æ¸¸å®¢æ¨¡å¼
- âœ… è®¾å¤‡IDæ”¯æŒ
- âœ… ä¸´æ—¶ç”¨æˆ·åˆ›å»º
- âœ… æ•°æ®éš”ç¦»

## ğŸš€ ç»“è®º

**æ•°æ®åº“ç»“æ„å®Œå…¨ç¬¦åˆè¦æ±‚ï¼**

1. **è¡¨ç»“æ„å®Œæ•´** - æ‰€æœ‰å¿…è¦çš„è¡¨éƒ½å·²åˆ›å»º
2. **å­—æ®µå®Œå¤‡** - æ”¯æŒç”¨æˆ·è®¤è¯å’Œæ•°æ®å­˜å‚¨
3. **å…³ç³»æ­£ç¡®** - å¤–é”®çº¦æŸå’Œçº§è”åˆ é™¤é…ç½®æ­£ç¡®
4. **å®‰å…¨å¯é ** - RLSç­–ç•¥å’Œæ•°æ®éªŒè¯å®Œå–„
5. **æ€§èƒ½ä¼˜åŒ–** - ç´¢å¼•é…ç½®åˆç†
6. **æ‰©å±•æ€§å¼º** - æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•

ç™»å½•æ³¨å†Œç³»ç»Ÿå¯ä»¥ç«‹å³æŠ•å…¥ä½¿ç”¨ï¼Œæ•°æ®åº“ç»“æ„ä¸ºåº”ç”¨æä¾›äº†åšå®çš„åŸºç¡€æ”¯æ’‘ã€‚